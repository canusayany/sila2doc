# SiLA 2 特性转换器使用指南

## 📖 简介

本工具用于将 SiLA 2 特性定义（XML 文件）转换为 Protocol Buffer (.proto) 文件和 C# 代码。

## 🚀 快速开始

### 1. 环境准备

- .NET 8.0 SDK
- 必要的 NuGet 包（项目已配置）

### 2. 文件结构

```
sila_csharp_converter/
├── xslt/                # XML → Proto 转换器
├── protobuf/            # SiLA 框架 Proto 定义
├── schema/              # XML Schema 验证文件
├── examples/            # 示例 XML 文件
├── SiLAConverter.cs     # 转换器主类
└── Program.cs           # 测试示例
```

### 3. 主要功能

#### 从文件转换

```csharp
// 单个文件转换：XML → Proto → C#
SiLAConverter.ConvertComplete("input.sila.xml", "output/");

// 仅转换为 Proto
SiLAConverter.ConvertXmlToProto("input.sila.xml", "output.proto");
```

#### 从内存转换（新功能）

```csharp
// 单个 XML 字符串转换
string xmlContent = File.ReadAllText("feature.sila.xml");
string protoResult = SiLAConverter.ConvertXmlStringToProto(xmlContent);

// 多个 XML 字符串批量转换
var xmlDict = new Dictionary<string, string>
{
    ["Feature1"] = xml1Content,
    ["Feature2"] = xml2Content
};
var results = SiLAConverter.ConvertXmlStringsToProto(xmlDict);
```

## 📝 API 说明

### 核心方法

| 方法 | 说明 |
|------|------|
| `ConvertXmlToProto(xmlPath, protoPath)` | 从文件转换 XML → Proto |
| `ConvertXmlStringToProto(xmlString)` | 从内存字符串转换 |
| `ConvertXmlStringsToProto(xmlDict)` | 批量从内存转换 |
| `CompileProtoToCSharp(protoPath, outputDir)` | 编译 Proto → C# |
| `ConvertComplete(xmlPath, outputDir)` | 完整流程：XML → Proto → C# |

### 转换流程

```
XML 文件/字符串 → [XSLT] → Proto 文件 → [protoc] → C# 代码
```

## 🔧 常见问题

**Q: 找不到 XSLT 文件？**
A: 确保 xslt 文件夹在程序运行目录。

**Q: Proto 编译失败？**
A: 检查是否安装了 Grpc.Tools NuGet 包。

**Q: 如何验证 XML 格式？**
A: 使用 `SiLAConverter.ValidateXml(xmlPath)` 方法。

## 📦 输出说明

### Proto 文件结构
- Package: `sila2.<originator>.<category>.<feature>.v<version>`
- Service: 包含所有命令和属性的 gRPC 服务定义
- Messages: 参数和响应消息定义

### C# 文件
- `<Feature>.cs`: 消息类定义
- `<Feature>Grpc.cs`: gRPC 客户端和服务器存根

## 📚 参考资源

- [SiLA 标准官网](https://sila-standard.com/)
- [SiLA GitLab](https://gitlab.com/SiLA2/sila_base)
- [gRPC C# 文档](https://grpc.io/docs/languages/csharp/)

