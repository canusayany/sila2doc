# SiLA2 D3é©±åŠ¨ç”Ÿæˆå·¥å…· - é¡¹ç›®æ–‡æ¡£

**é¡¹ç›®çŠ¶æ€**ï¼šâœ… **å·²å®Œæˆå¹¶å…¨é¢éªŒè¯**  
**æœ€åæ›´æ–°**ï¼š2024-10-24 16:30  
**ç»´æŠ¤è€…**ï¼šBioyond Team

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#ä¸€é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½](#äºŒæ ¸å¿ƒåŠŸèƒ½)
3. [UIè®¾è®¡](#ä¸‰uiè®¾è®¡)
4. [æ•°æ®æ¨¡å‹](#å››æ•°æ®æ¨¡å‹)
5. [å…³é”®æŠ€æœ¯ç‚¹](#äº”å…³é”®æŠ€æœ¯ç‚¹)
6. [å®æ–½å†å²ä¸å…³é”®æ”¹è¿›](#å…­å®æ–½å†å²ä¸å…³é”®æ”¹è¿›)
7. [æµ‹è¯•è¦†ç›–](#ä¸ƒæµ‹è¯•è¦†ç›–)
8. [ä½¿ç”¨æŒ‡å—](#å…«ä½¿ç”¨æŒ‡å—)

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

æœ¬å·¥å…·æ˜¯"**ä¸€ç«™å¼è®¾å¤‡é©±åŠ¨ç”Ÿæˆå·¥å…·**"çš„SiLA2/gRPCåè®®æ¨¡å—ï¼Œç”¨äºä»SiLA2æœåŠ¡å™¨æˆ–æœ¬åœ°ç‰¹æ€§æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆç¬¦åˆD3ç³»ç»Ÿè§„èŒƒçš„é©±åŠ¨ä»£ç ã€‚

### 1.2 æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SiLA2 ç‰¹æ€§æº                                               â”‚
â”‚  â€¢ åœ¨çº¿æœåŠ¡å™¨ï¼ˆmDNSæ‰«æï¼‰                                    â”‚
â”‚  â€¢ æœ¬åœ° .sila.xml æ–‡ä»¶                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tecan Generator (ç¬¬ä¸‰æ–¹å·¥å…·)                               â”‚
â”‚  â€¢ ç”Ÿæˆæ¥å£å®šä¹‰ (Interface)                                 â”‚
â”‚  â€¢ ç”Ÿæˆå®¢æˆ·ç«¯å®ç° (Client)                                  â”‚
â”‚  â€¢ ç”Ÿæˆæ•°æ®ä¼ è¾“å¯¹è±¡ (DTOs)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»£ç åˆ†ææœåŠ¡ (ClientCodeAnalyzer)                          â”‚
â”‚  â€¢ åå°„åˆ†æç”Ÿæˆçš„ä»£ç                                        â”‚
â”‚  â€¢ æå–æ–¹æ³•ã€å‚æ•°ã€è¿”å›å€¼ä¿¡æ¯                               â”‚
â”‚  â€¢ æå–XMLæ–‡æ¡£æ³¨é‡Š                                          â”‚
â”‚  â€¢ æ£€æµ‹æ•°æ®ç±»å‹æ”¯æŒæƒ…å†µ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–¹æ³•é¢„è§ˆä¸ç‰¹æ€§è°ƒæ•´ (ç”¨æˆ·äº¤äº’)                              â”‚
â”‚  â€¢ ç”¨æˆ·å‹¾é€‰"è°ƒåº¦æ–¹æ³•" (MethodOperations)                    â”‚
â”‚  â€¢ ç”¨æˆ·å‹¾é€‰"ç»´æŠ¤æ–¹æ³•" (MethodMaintenance)                   â”‚
â”‚  â€¢ æä¾›æ‰¹é‡æ“ä½œåŠŸèƒ½                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  D3é©±åŠ¨ä»£ç ç”Ÿæˆ (CodeDOM)                                   â”‚
â”‚  â€¢ AllSila2Client.cs - å¤šç‰¹æ€§æ•´åˆã€æ–¹æ³•å¹³é“º                â”‚
â”‚  â€¢ D3Driver.cs - é©±åŠ¨ä¸»ç±»ã€æ–¹æ³•åˆ†ç±»ã€JSONè½¬æ¢               â”‚
â”‚  â€¢ Sila2Base.cs - åŸºç±»å®ç°                                  â”‚
â”‚  â€¢ CommunicationPars.cs - IP/Porté…ç½®                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¹ç›®ç¼–è¯‘                                                   â”‚
â”‚  â€¢ ç”Ÿæˆ .csproj å’Œ .sln æ–‡ä»¶                                â”‚
â”‚  â€¢ å¤åˆ¶ä¾èµ–åº“ (reflib)                                      â”‚
â”‚  â€¢ æ‰§è¡Œ dotnet build                                        â”‚
â”‚  â€¢ ç”Ÿæˆ DLL å’Œ XML æ–‡æ¡£                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ä¾èµ–å·¥å…·

| å·¥å…· | ç”¨é€” | æ¥æº |
|------|------|------|
| **Tecan Generator** | ä».sila.xmlç”ŸæˆC# gRPCå®¢æˆ·ç«¯ä»£ç  | ç¬¬ä¸‰æ–¹ (Tecan) |
| **BR.PC.Device.Sila2Discovery** | SiLA2æœåŠ¡å™¨çš„mDNSæ‰«æå’Œè¿æ¥ç®¡ç† | Bioyond |
| **Microsoft CodeDOM** | ç”ŸæˆD3é©±åŠ¨å°è£…å±‚ä»£ç  | .NET Framework |
| **Newtonsoft.Json** | JSONåºåˆ—åŒ–/ååºåˆ—åŒ– | NuGet |
| **.NET SDK 8.0** | é¡¹ç›®ç¼–è¯‘å’ŒDLLç”Ÿæˆ | Microsoft |

---

## äºŒã€æ ¸å¿ƒåŠŸèƒ½

### 2.1 å®Œæ•´å·¥ä½œæµç¨‹

1. **ç‰¹æ€§é€‰æ‹©**
   - æ‰«æåœ¨çº¿æœåŠ¡å™¨æˆ–å¯¼å…¥æœ¬åœ°.sila.xmlæ–‡ä»¶
   - æ”¯æŒå¤šç‰¹æ€§é€‰æ‹©ï¼ˆé™åŒä¸€æœåŠ¡å™¨ï¼‰
   - çˆ¶èŠ‚ç‚¹ä¸‰æ€æ˜¾ç¤ºï¼ˆæœªé€‰/åŠé€‰/å…¨é€‰ï¼‰

2. **è®¾å¤‡ä¿¡æ¯è¾“å…¥**
   - å“ç‰Œï¼ˆBrandï¼‰
   - å‹å·ï¼ˆModelï¼‰
   - è®¾å¤‡ç±»å‹ï¼ˆDeviceTypeï¼‰
   - å¼€å‘è€…ï¼ˆDeveloperï¼‰

3. **å®¢æˆ·ç«¯ä»£ç ç”Ÿæˆ**
   - ä½¿ç”¨Tecan Generatorç”Ÿæˆå¼ºç±»å‹ä»£ç 
   - è‡ªåŠ¨å¤åˆ¶å¿…éœ€çš„DLLï¼ˆTecan.Sila2ã€gRPCã€protobufç­‰ï¼‰
   - è‡ªåŠ¨å»é‡é‡å¤çš„ç±»å‹å®šä¹‰

4. **æ–¹æ³•é¢„è§ˆä¸åˆ†ç±»**
   - æ˜¾ç¤ºæ‰€æœ‰æ£€æµ‹åˆ°çš„æ–¹æ³•
   - ç”¨æˆ·å‹¾é€‰"è°ƒåº¦æ–¹æ³•"å’Œ"ç»´æŠ¤æ–¹æ³•"
   - æ”¯æŒæ‰¹é‡æ“ä½œï¼ˆå…¨éƒ¨è®¾ä¸ºè°ƒåº¦/ç»´æŠ¤ã€æ¸…é™¤ç‰¹æ€§ï¼‰

5. **D3é©±åŠ¨ä»£ç ç”Ÿæˆ**
   - è‡ªåŠ¨ç”Ÿæˆå‘½åç©ºé—´ï¼š`BR.ECS.DeviceDrivers.{DeviceType}.{Brand}_{Model}`
   - ç”Ÿæˆ4ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼š`AllSila2Client.cs`ã€`D3Driver.cs`ã€`Sila2Base.cs`ã€`CommunicationPars.cs`
   - è‡ªåŠ¨å¤„ç†ä¸æ”¯æŒçš„æ•°æ®ç±»å‹ï¼ˆJSONåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼‰

6. **é¡¹ç›®ç¼–è¯‘**
   - ç”Ÿæˆ.csprojå’Œ.slnæ–‡ä»¶
   - é…ç½®XMLæ–‡æ¡£ç”Ÿæˆ
   - æ‰§è¡Œdotnet build
   - è¾“å‡ºDLLå’ŒXMLæ–‡æ¡£æ–‡ä»¶

### 2.2 å…³é”®ç‰¹æ€§

#### 2.2.1 çµæ´»çš„æ–¹æ³•æ ‡è®°ç³»ç»Ÿ

- **IsIncluded**ï¼šæ˜¯å¦åŒ…å«åœ¨D3Driverä¸­ï¼ˆé»˜è®¤trueï¼‰
- **IsOperations**ï¼šæ˜¯å¦ä¸ºè°ƒåº¦æ–¹æ³•ï¼ˆé»˜è®¤falseï¼‰
- **IsMaintenance**ï¼šæ˜¯å¦ä¸ºç»´æŠ¤æ–¹æ³•ï¼ˆé»˜è®¤æ ¹æ®æ–¹æ³•ååˆ¤æ–­ï¼‰

æ–¹æ³•å¯ä»¥ï¼š
- âœ… åŒæ—¶æ˜¯è°ƒåº¦æ–¹æ³•å’Œç»´æŠ¤æ–¹æ³•
- âœ… åªæ˜¯è°ƒåº¦æ–¹æ³•
- âœ… åªæ˜¯ç»´æŠ¤æ–¹æ³•
- âœ… ä¸¤è€…éƒ½ä¸æ˜¯ï¼ˆä¸ä¼šç”Ÿæˆåˆ°D3Driverä¸­ï¼‰

#### 2.2.2 æ™ºèƒ½ç±»å‹è½¬æ¢

**æ”¯æŒçš„ç±»å‹**ï¼ˆç›´æ¥ä½¿ç”¨ï¼‰ï¼š
- åŸºç¡€ç±»å‹ï¼šint, byte, sbyte, string, DateTime, double, float, bool, byte[], long, short, ushort, uint, ulong, decimal, char
- æšä¸¾ç±»å‹
- åŸºç¡€ç±»å‹çš„æ•°ç»„å’Œåˆ—è¡¨

**ä¸æ”¯æŒçš„ç±»å‹**ï¼ˆè‡ªåŠ¨è½¬æ¢ä¸ºJsonStringï¼‰ï¼š
- å¤æ‚çš„è‡ªå®šä¹‰ç±»å‹
- åµŒå¥—çš„å¤åˆç±»å‹
- Tecan.Sila2.DynamicClient.DynamicObjectProperty

**è½¬æ¢ç¤ºä¾‹**ï¼š
```csharp
// AllSila2Client.cs - ä¿æŒåŸæ ·
public virtual SetAnyTypeValueResponse SetAnyTypeValue(
    DynamicObjectProperty anyTypeValue) { ... }

// D3Driver.cs - è‡ªåŠ¨è½¬æ¢
[MethodOperations]
public virtual string SetAnyTypeValue(string anyTypeValueJsonString)
{
    var anyTypeValue = JsonConvert.DeserializeObject<DynamicObjectProperty>(anyTypeValueJsonString);
    var result = this._sila2Device.SetAnyTypeValue(anyTypeValue);
    return JsonConvert.SerializeObject(result);
}
```

#### 2.2.3 ä»£ç å»é‡æœºåˆ¶

Tecan Generatoråœ¨ç”Ÿæˆå¤šä¸ªç‰¹æ€§æ—¶å¯èƒ½äº§ç”Ÿé‡å¤çš„ç±»å‹å®šä¹‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
- è§£ææ‰€æœ‰ç”Ÿæˆçš„C#æ–‡ä»¶
- è¯†åˆ«é‡å¤çš„é¡¶å±‚ç±»å‹ï¼ˆç±»ã€æšä¸¾ã€ç»“æ„ã€æ¥å£ã€å§”æ‰˜ï¼‰
- æ³¨é‡Šæ‰é‡å¤çš„å®šä¹‰ï¼Œä¿ç•™ç¬¬ä¸€æ¬¡å‡ºç°çš„
- ä¸å½±å“åµŒå¥—ç±»å‹å’Œä¸åŒå‘½åç©ºé—´çš„åŒåç±»å‹

#### 2.2.4 DTOæ„é€ å‡½æ•°ç‰¹æ€§

è‡ªåŠ¨ä¸ºæ‰€æœ‰DTOç±»çš„é»˜è®¤æ„é€ å‡½æ•°æ·»åŠ  `[JsonConstructor]` ç‰¹æ€§ï¼š
```csharp
[JsonConstructor()]
public SetAnyTypeValueRequestDto() { }
```

---

## ä¸‰ã€UIè®¾è®¡

### 3.1 ä¸»ç•Œé¢å¸ƒå±€ï¼ˆä¸‰åˆ—å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â‹®] ä¾§è¾¹æ                 â”‚ â”‚  ä¸»åŒºåŸŸ                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” æ‰«æ ğŸ“ æ·»åŠ  ğŸ“¤ å¯¼å‡ºâ”‚  â”‚ â”‚  â”‚ ç”Ÿæˆè¿‡ç¨‹ä¿¡æ¯             â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚  â”‚ [æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸ]           â”‚â”‚
â”‚  â”‚ åœ¨çº¿æœåŠ¡å™¨ (250px)    â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚ â˜‘ Server 1          â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â˜ Feature A       â”‚  â”‚ â”‚  â”‚ é¡¹ç›®ä¿¡æ¯                 â”‚â”‚
â”‚  â”‚   â˜ Feature B       â”‚  â”‚ â”‚  â”‚ é¡¹ç›®ï¼šXXX_YYY           â”‚â”‚
â”‚  â”‚ â˜ Server 2          â”‚  â”‚ â”‚  â”‚ è·¯å¾„ï¼šC:\...            â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚  â”‚ çŠ¶æ€ï¼šå·²ç¼–è¯‘             â”‚â”‚
â”‚  â”‚ æœ¬åœ°ç‰¹æ€§ (å¯å˜é«˜åº¦)   â”‚  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚ â˜ Node1             â”‚  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   â˜ file1.sila.xml  â”‚  â”‚ â”‚  â”‚ [æŒ‰é’®åŒºåŸŸ]               â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â”‚ ğŸ—‚ï¸æ‰“å¼€é¡¹ç›® ğŸ“¦æ‰“å¼€DLL    â”‚â”‚
â”‚                             â”‚ â”‚  â”‚ âœ¨ç”ŸæˆD3 ğŸ”¨ç¼–è¯‘ ğŸ”§è°ƒæ•´   â”‚â”‚
â”‚                             â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ–¹æ³•é¢„è§ˆä¸ç‰¹æ€§è°ƒæ•´çª—å£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–¹æ³•é¢„è§ˆä¸ç‰¹æ€§è°ƒæ•´                                    [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¯·å‹¾é€‰éœ€è¦æ ‡è®°ä¸º"è°ƒåº¦æ–¹æ³•"æˆ–"ç»´æŠ¤æ–¹æ³•"çš„æ–¹æ³•              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç‰¹æ€§åç§°  â”‚ æ–¹æ³•åç§°    â”‚ ç±»å‹ â”‚ è¿”å›å€¼ â”‚â˜‘è°ƒåº¦â”‚â˜‘ç»´æŠ¤â”‚ è¯´æ˜â”‚
â”‚  Feature1  â”‚ Method1     â”‚ Cmd  â”‚ void   â”‚ â˜  â”‚ â˜‘  â”‚ ... â”‚
â”‚  Feature1  â”‚ Method2     â”‚ Cmd  â”‚ int    â”‚ â˜‘  â”‚ â˜  â”‚ ... â”‚
â”‚  Feature2  â”‚ GetTemp     â”‚ Prop â”‚ double â”‚ â˜‘  â”‚ â˜  â”‚ ... â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å…¨éƒ¨è°ƒåº¦] [å…¨éƒ¨ç»´æŠ¤] [æ¸…é™¤ç‰¹æ€§]    [ç¡®å®š] [å–æ¶ˆ]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 æ“ä½œæŒ‰é’®

| æŒ‰é’® | åŠŸèƒ½ | å¯ç”¨æ¡ä»¶ |
|------|------|---------|
| ğŸ—‚ï¸ æ‰“å¼€é¡¹ç›®ç›®å½• | æ‰“å¼€ç”Ÿæˆçš„é¡¹ç›®ç›®å½• | é¡¹ç›®å·²ç”Ÿæˆ |
| ğŸ“¦ æ‰“å¼€DLLç›®å½• | æ‰“å¼€ç¼–è¯‘è¾“å‡ºçš„DLLç›®å½• | é¡¹ç›®å·²ç¼–è¯‘ |
| âœ¨ ç”ŸæˆD3é¡¹ç›® | ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç å’ŒD3é©±åŠ¨ä»£ç  | å·²é€‰æ‹©ç‰¹æ€§ |
| ğŸ”¨ ç¼–è¯‘D3é¡¹ç›® | ç¼–è¯‘å·²ç”Ÿæˆçš„é¡¹ç›® | é¡¹ç›®å·²ç”Ÿæˆ |
| ğŸ”§ è°ƒæ•´æ–¹æ³•ç‰¹æ€§ | é‡æ–°æ‰“å¼€æ–¹æ³•é¢„è§ˆçª—å£ | é¡¹ç›®å·²ç”Ÿæˆ |

---

## å››ã€æ•°æ®æ¨¡å‹

### 4.1 æ ¸å¿ƒæ•°æ®ç»“æ„

#### ClientFeatureInfo
```csharp
public class ClientFeatureInfo
{
    public Type InterfaceType { get; set; }
    public string FeatureName { get; set; }
    public string InterfaceName { get; set; }
    public string ClientName { get; set; }
    public List<MethodGenerationInfo> Methods { get; set; }
}
```

#### MethodGenerationInfo
```csharp
public class MethodGenerationInfo
{
    public string Name { get; set; }
    public Type ReturnType { get; set; }
    public List<ParameterGenerationInfo> Parameters { get; set; }
    public XmlDocumentationInfo XmlDocumentation { get; set; }
    
    // æ–¹æ³•æ ‡è®°
    public bool IsIncluded { get; set; } = true;
    public bool IsOperations { get; set; } = false;
    public bool IsMaintenance { get; set; } = false;
    
    // ç±»å‹è½¬æ¢æ ‡è¯†
    public bool RequiresJsonReturn { get; set; }
    
    // å…¶ä»–å±æ€§
    public bool IsProperty { get; set; }
    public bool IsObservableCommand { get; set; }
    public string FeatureName { get; set; }
}
```

#### ParameterGenerationInfo
```csharp
public class ParameterGenerationInfo
{
    public string Name { get; set; }
    public Type Type { get; set; }
    public string Description { get; set; }
    public XmlDocumentationInfo XmlDocumentation { get; set; }
    public bool RequiresJsonParameter { get; set; }
}
```

#### D3DriverGenerationConfig
```csharp
public class D3DriverGenerationConfig
{
    public string Brand { get; set; }
    public string Model { get; set; }
    public string DeviceType { get; set; }
    public string Developer { get; set; }
    
    // è‡ªåŠ¨ç”Ÿæˆ
    public string Namespace { get; set; }  // BR.ECS.DeviceDrivers.{DeviceType}.{Brand}_{Model}
    public string OutputPath { get; set; }  // {Temp}/Sila2D3Gen/{Brand}_{Model}_{Timestamp}
    
    public List<ClientFeatureInfo> Features { get; set; }
    
    // ç‰¹æ€§æ¥æº
    public bool IsOnlineSource { get; set; }
    public string ServerUuid { get; set; }
    public string ServerIp { get; set; }
    public int? ServerPort { get; set; }
    public List<string> LocalFeatureXmlPaths { get; set; }
}
```

### 4.2 DeviceClassç‰¹æ€§è§„åˆ™

```csharp
[DeviceClass(brand, model, injectionKey, deviceType, developer)]
public class D3Driver : Sila2Base { }
```

**å‚æ•°è¯´æ˜**ï¼š
- `brand`ï¼šå“ç‰Œï¼ˆè‹±æ–‡ã€ä¸‹åˆ’çº¿ã€æ•°å­—ï¼‰
- `model`ï¼šå‹å·ï¼ˆè‹±æ–‡ã€ä¸‹åˆ’çº¿ã€æ•°å­—ï¼‰
- `injectionKey`ï¼šæ³¨å…¥é”®ï¼Œé€šå¸¸ä¸º `{Brand}{Model}`ï¼ˆæ— åˆ†éš”ç¬¦ï¼‰
- `deviceType`ï¼šè®¾å¤‡ç±»å‹ï¼ˆè‹±æ–‡ã€ä¸‹åˆ’çº¿ã€æ•°å­—ï¼‰
- `developer`ï¼šå¼€å‘è€…åç§°

**ç¤ºä¾‹**ï¼š
```csharp
[DeviceClass("Bioyond", "MD", "BioyondMD", "Robot", "Name")]
public class D3Driver : Sila2Base { }
```

### 4.3 D3Driveræ–¹æ³•ç”Ÿæˆè§„èŒƒ

**åŒæ­¥æ€§è¦æ±‚**ï¼ˆå…³é”®çº¦æŸï¼‰ï¼š
- âš ï¸ æ‰€æœ‰D3è°ƒç”¨çš„æ–¹æ³•å¿…é¡»æ˜¯åŒæ­¥çš„
- âš ï¸ ç¦æ­¢ä½¿ç”¨ `async/await`
- å¯è§‚å¯Ÿå‘½ä»¤ä½¿ç”¨ `command.Response.GetAwaiter().GetResult()` é˜»å¡ç­‰å¾…

**æ–¹æ³•ç‰¹æ€§æ ‡è®°**ï¼š
```csharp
// è°ƒåº¦æ–¹æ³•
[MethodOperations]
public double GetCurrentTemperature() { ... }

// ç»´æŠ¤æ–¹æ³•ï¼ˆå‚æ•°ä¸ºé¡ºåºç¼–å·ï¼‰
[MethodMaintenance(1)]
public bool GetDeviceState() { ... }

[MethodMaintenance(2)]
public void SwitchDeviceState(bool isOn) { ... }

// åŒæ—¶æ ‡è®°ä¸¤ä¸ªç‰¹æ€§
[MethodOperations]
[MethodMaintenance(3)]
public void Initialize() { ... }
```

**XMLæ³¨é‡Šè¦æ±‚**ï¼š
- æ‰€æœ‰å¸¦ç‰¹æ€§æ ‡è®°çš„æ–¹æ³•å¿…é¡»æœ‰å®Œæ•´çš„XMLæ³¨é‡Š
- æ³¨é‡Šä»Tecan Generatorç”Ÿæˆçš„ä»£ç ä¸­è‡ªåŠ¨æå–

---

## äº”ã€å…³é”®æŠ€æœ¯ç‚¹

### 5.1 ä¸‰æ€CheckBoxå®ç°

```xaml
<CheckBox IsThreeState="True" 
          IsChecked="{Binding IsPartiallySelected, Mode=TwoWay}"
          Content="{Binding ServerName}"/>
```

**ä¸‰æ€é€»è¾‘**ï¼š
- `null` = åŠé€‰ï¼ˆéƒ¨åˆ†å­é¡¹è¢«é€‰ä¸­ï¼‰
- `false` = æœªé€‰ï¼ˆæ‰€æœ‰å­é¡¹æœªé€‰ï¼‰
- `true` = å…¨é€‰ï¼ˆæ‰€æœ‰å­é¡¹è¢«é€‰ï¼‰

### 5.2 CheckBoxå•å‡»å“åº”ä¼˜åŒ–

ä½¿ç”¨ `DataGridTemplateColumn` æ›¿ä»£ `DataGridCheckBoxColumn`ï¼š

```xml
<DataGridTemplateColumn Width="90" Header="è°ƒåº¦æ–¹æ³•">
    <DataGridTemplateColumn.CellTemplate>
        <DataTemplate>
            <CheckBox 
                IsChecked="{Binding IsOperations, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center" />
        </DataTemplate>
    </DataGridTemplateColumn.CellTemplate>
</DataGridTemplateColumn>
```

### 5.3 å•æœåŠ¡å™¨é€‰æ‹©æ ¡éªŒ

```csharp
partial void OnIsSelectedChanged(bool value)
{
    if (value)
    {
        var viewModel = GetD3DriverViewModel();
        if (!viewModel.ValidateServerSelection(this))
        {
            // æ ¡éªŒå¤±è´¥ï¼ŒIsSelectedå·²è¢«é‡ç½®ä¸ºfalse
            return;
        }
    }
    
    ParentServer?.UpdateParentSelectionState();
}
```

### 5.4 å‹å¥½ç±»å‹åç§°ç”Ÿæˆ

é¿å…ç”Ÿæˆå¸¦ç¨‹åºé›†ä¿¡æ¯çš„å®Œæ•´é™å®šåç§°ï¼š

```csharp
private string GetFriendlyTypeName(Type type)
{
    if (type.IsGenericType)
    {
        var typeName = type.GetGenericTypeDefinition().FullName;
        var backtickIndex = typeName.IndexOf('`');
        if (backtickIndex > 0)
            typeName = typeName.Substring(0, backtickIndex);
        
        var genericArgs = type.GetGenericArguments();
        var genericArgNames = genericArgs.Select(GetFriendlyTypeName);
        return $"{typeName}<{string.Join(", ", genericArgNames)}>";
    }
    // ...
}
```

**æ•ˆæœå¯¹æ¯”**ï¼š
- âŒ `ICollection`1[[Stream, System.Private.CoreLib, Version=8.0.0.0, ...]]`
- âœ… `System.Collections.Generic.ICollection<System.IO.Stream>`

### 5.5 ä»£ç å»é‡ç­–ç•¥

åªå¤„ç†é¡¶å±‚ç±»å‹å®šä¹‰ï¼Œé¿å…è¯¯ä¼¤åµŒå¥—ç±»å‹ï¼š

```csharp
var classes = root.DescendantNodes().OfType<ClassDeclarationSyntax>()
    .Where(c => c.Parent is NamespaceDeclarationSyntax ||
                c.Parent is FileScopedNamespaceDeclarationSyntax ||
                c.Parent is CompilationUnitSyntax);
```

### 5.6 XMLæ–‡æ¡£ç”Ÿæˆé…ç½®

åœ¨.csprojä¸­æ·»åŠ ï¼š

```xml
<PropertyGroup>
  <GenerateDocumentationFile>true</GenerateDocumentationFile>
  <DocumentationFile>bin\$(Configuration)\$(TargetFramework)\{projectName}.xml</DocumentationFile>
</PropertyGroup>
```

---

## å…­ã€å®æ–½å†å²ä¸å…³é”®æ”¹è¿›

### 6.1 ç¬¬ä¸€å¤©ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆ2024-10-23ï¼‰

**å®Œæˆå†…å®¹**ï¼š
- âœ… åŸºç¡€æ¶æ„æ­å»ºï¼ˆModelsã€Servicesã€ViewModelsï¼‰
- âœ… UIå®ç°ï¼ˆä¸‰åˆ—å¸ƒå±€ã€ä¾§è¾¹æ åˆ‡æ¢ã€æ–¹æ³•é¢„è§ˆçª—å£ï¼‰
- âœ… åœ¨çº¿æœåŠ¡å™¨æ‰«æå’Œè¿æ¥
- âœ… æœ¬åœ°ç‰¹æ€§æ–‡ä»¶å¯¼å…¥å’Œç®¡ç†
- âœ… Tecan Generatoré›†æˆ
- âœ… ClientCodeAnalyzerå®ç°ï¼ˆåŠ¨æ€ç¼–è¯‘åˆ†æï¼‰
- âœ… D3é©±åŠ¨ä»£ç ç”Ÿæˆï¼ˆCodeDOMï¼‰
- âœ… é¡¹ç›®ç¼–è¯‘åŠŸèƒ½
- âœ… æµ‹è¯•æ§åˆ¶å°é¡¹ç›®ï¼ˆ6ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰

**å…³é”®ä¿®å¤**ï¼š
- **é—®é¢˜1**ï¼šClientCodeAnalyzerç¼–è¯‘é”™è¯¯ `CS0012: ç±»å‹"List<>"åœ¨æœªå¼•ç”¨çš„ç¨‹åºé›†ä¸­å®šä¹‰`
  - è§£å†³ï¼šæ·»åŠ  `System.Collections` ç¨‹åºé›†å¼•ç”¨

### 6.2 ç¬¬äºŒå¤©ï¼šæ–¹æ³•æ ‡è®°ç³»ç»Ÿé‡å¤§æ”¹è¿›ï¼ˆ2024-10-24 ä¸Šåˆï¼‰

**æ ¸å¿ƒæ”¹è¿›**ï¼šä»å•é€‰å˜ä¸ºå¤šé€‰æ ‡è®°ç³»ç»Ÿ

**ä¹‹å‰è®¾è®¡**ï¼š
- åªæœ‰ä¸€ä¸ª `IsMaintenance` å¸ƒå°”å­—æ®µ
- æ–¹æ³•åªèƒ½æ˜¯"ç»´æŠ¤æ–¹æ³•"æˆ–"è°ƒåº¦æ–¹æ³•"ä¹‹ä¸€

**æ”¹è¿›å**ï¼š
- `IsIncluded`ï¼šæ˜¯å¦åŒ…å«ï¼ˆé»˜è®¤trueï¼‰
- `IsOperations`ï¼šæ˜¯å¦ä¸ºè°ƒåº¦æ–¹æ³•ï¼ˆé»˜è®¤falseï¼‰
- `IsMaintenance`ï¼šæ˜¯å¦ä¸ºç»´æŠ¤æ–¹æ³•ï¼ˆé»˜è®¤æ ¹æ®æ–¹æ³•ååˆ¤æ–­ï¼‰
- æ–¹æ³•å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªç‰¹æ€§æˆ–ä¸æ‹¥æœ‰ä»»ä½•ç‰¹æ€§

**å…¶ä»–ä¿®å¤**ï¼š
- **é—®é¢˜2**ï¼šç”Ÿæˆçš„D3é¡¹ç›®æœªå¤åˆ¶reflibæ–‡ä»¶
  - è§£å†³ï¼šæ·»åŠ  `FindReflibDirectory` æ–¹æ³•ï¼Œä¼˜å…ˆä»reflibç›®å½•å¤åˆ¶DLL
- **é—®é¢˜3**ï¼šCheckBoxéœ€è¦ç‚¹å‡»ä¸¤æ¬¡
  - è§£å†³ï¼šä½¿ç”¨ `DataGridTemplateColumn` æ›¿ä»£ `DataGridCheckBoxColumn`
- **é—®é¢˜4**ï¼šDataGridæœ‰ç©ºè¡Œ
  - è§£å†³ï¼šè®¾ç½® `CanUserAddRows="False"`
- **é—®é¢˜5**ï¼šæ²¡æœ‰ç‰¹æ€§æ ‡è®°çš„æ–¹æ³•ä¹Ÿè¢«ç”Ÿæˆ
  - è§£å†³ï¼šè¿‡æ»¤æ¡ä»¶æ”¹ä¸º `m.IsIncluded && (m.IsOperations || m.IsMaintenance)`

### 6.3 ç¬¬äºŒå¤©ä¸‹åˆï¼šé¡¹ç›®åç§°ä¸UIä¼˜åŒ–ï¼ˆ2024-10-24 ä¸‹åˆï¼‰

**æ”¹è¿›å†…å®¹**ï¼š
- âœ… **é¡¹ç›®åç§°ä¸å‘½åç©ºé—´ç»Ÿä¸€**ï¼šä½¿ç”¨å‘½åç©ºé—´ä½œä¸ºé¡¹ç›®å
  - ä¹‹å‰ï¼š`{Brand}{Model}.D3Driver.csproj`
  - ç°åœ¨ï¼š`BR.ECS.DeviceDrivers.{DeviceType}.{Brand}_{Model}.csproj`
- âœ… **å½»åº•ä¿®å¤CheckBoxç‚¹å‡»é—®é¢˜**ï¼šæ”¹ç”¨æ¨¡æ¿åˆ—
- âœ… **ç®€åŒ–æ–¹æ³•é¢„è§ˆç•Œé¢**ï¼šç§»é™¤å†—ä½™çš„"åŒ…å«"åˆ—
- âœ… **ç¼–è¯‘æ‰¾ä¸åˆ°é¡¹ç›®æ–‡ä»¶é—®é¢˜**ï¼šä¿®æ­£é¡¹ç›®æ–‡ä»¶è·¯å¾„
- âœ… **XMLæ³¨é‡Šæ–‡ä»¶ç”Ÿæˆé…ç½®**ï¼šæ·»åŠ  `<GenerateDocumentationFile>true</GenerateDocumentationFile>`

### 6.4 ç¬¬äºŒå¤©æ™šä¸Šï¼šåœ¨çº¿æœåŠ¡å™¨æµ‹è¯•å®Œæ•´ä¿®å¤ï¼ˆ2024-10-24 æ™šä¸Šï¼‰

**é—®é¢˜**ï¼šåœ¨çº¿æœåŠ¡å™¨æµ‹è¯•å¤±è´¥
- `CS0234`: å‘½åç©ºé—´"Tecan.Sila2"ä¸­ä¸å­˜åœ¨ç±»å‹æˆ–å‘½åç©ºé—´å"DynamicClient"
- `CS0101/CS0111`: ç±»å‹é‡å¤å®šä¹‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **æ·»åŠ DLLè‡ªåŠ¨å¤åˆ¶æœºåˆ¶**ï¼š
   - åœ¨ `ClientCodeGenerator.cs` ä¸­æ·»åŠ  `CopyRequiredDllsToClientDirectory` æ–¹æ³•
   - å¤åˆ¶æ‰€æœ‰å¿…éœ€çš„Tecanå’ŒgRPC DLLåˆ°GeneratedClientç›®å½•
   
2. **å®ç°ä»£ç å»é‡åŠŸèƒ½**ï¼š
   - åˆ›å»º `GeneratedCodeDeduplicator.cs` ç±»
   - ä½¿ç”¨Roslynè§£æç”Ÿæˆçš„C#ä»£ç 
   - è¯†åˆ«å¹¶æ³¨é‡Šæ‰é‡å¤çš„é¡¶å±‚ç±»å‹å®šä¹‰
   - åªå¤„ç†é¡¶å±‚ç±»å‹ï¼Œä¸å½±å“åµŒå¥—ç±»å‹

3. **è¡¥å……ç¼ºå¤±çš„DynamicClient.dll**ï¼š
   - åœ¨å¿…éœ€DLLåˆ—è¡¨ä¸­æ·»åŠ  `Tecan.Sila2.DynamicClient.dll`

**ç»“æœ**ï¼š
- âœ… æ‰€æœ‰7ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡
- âœ… åœ¨çº¿æœåŠ¡å™¨æµ‹è¯•æˆåŠŸï¼ˆ23ä¸ªç‰¹æ€§ã€69ä¸ªæ–‡ä»¶ï¼‰

### 6.5 æœ€ç»ˆä¼˜åŒ–ï¼šä»£ç ç”Ÿæˆé€»è¾‘ä¼˜åŒ–ï¼ˆ2024-10-24 ä¸‹åˆ3ç‚¹ï¼‰

**ä¼˜åŒ–ç›®æ ‡**ï¼š
- `AllSila2Client.cs`ï¼šä¿æŒåŸå§‹æ–¹æ³•ç­¾åï¼Œä¸æ·»åŠ é¢å¤–JSONå‚æ•°
- `D3Driver.cs`ï¼šå¯¹ä¸æ”¯æŒçš„ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸ºJsonString

**å®æ–½å†…å®¹**ï¼š

1. **ç®€åŒ– AllSila2ClientGenerator**ï¼š
   - ç§»é™¤é¢å¤–JSONå‚æ•°çš„æ·»åŠ é€»è¾‘
   - ç§»é™¤JSONç›¸å…³çš„æ³¨é‡Šæç¤º
   - ä¿æŒæ–¹æ³•ç­¾åä¸Tecan Generatorç”Ÿæˆçš„ä»£ç ä¸€è‡´

2. **å¢å¼º D3DriverGenerator**ï¼š
   - å‚æ•°ç±»å‹è½¬æ¢ï¼š`Type param` â†’ `string paramJsonString`
   - è¿”å›ç±»å‹è½¬æ¢ï¼š`ComplexType` â†’ `string`
   - å®ç°æ–¹æ³•ä½“çš„åºåˆ—åŒ–/ååºåˆ—åŒ–é€»è¾‘
   - æ·»åŠ JSONæ ¼å¼æ ‡è¯†çš„æ³¨é‡Š

3. **ä¿®å¤ç±»å‹åç§°ç”Ÿæˆé—®é¢˜**ï¼š
   - æ·»åŠ  `GetFriendlyTypeName` æ–¹æ³•
   - é¿å…ç”Ÿæˆå¸¦ç¨‹åºé›†ä¿¡æ¯çš„å®Œæ•´é™å®šåç§°
   - æ­£ç¡®å¤„ç†æ³›å‹ã€åµŒå¥—æ³›å‹ã€æ•°ç»„ç­‰å¤æ‚ç±»å‹

### 6.6 æœ€åæ”¹è¿›ï¼šDTOæ„é€ å‡½æ•°ç‰¹æ€§ï¼ˆ2024-10-24 ä¸‹åˆ4ç‚¹ï¼‰

**éœ€æ±‚**ï¼šä¸ºç”Ÿæˆçš„DTOç±»çš„æ„é€ å‡½æ•°æ·»åŠ  `[JsonConstructor]` ç‰¹æ€§

**å®æ–½**ï¼š
- ä¿®æ”¹ `Generator/Generators/DtoGenerator.cs`
- æ·»åŠ  `Newtonsoft.Json` å‘½åç©ºé—´å¯¼å…¥
- åœ¨é»˜è®¤æ„é€ å‡½æ•°ä¸Šæ·»åŠ  `[JsonConstructor]` ç‰¹æ€§

**ç»“æœ**ï¼š
- âœ… æ‰€æœ‰DTOç±»çš„é»˜è®¤æ„é€ å‡½æ•°åŒ…å« `[JsonConstructor()]` ç‰¹æ€§
- âœ… JSONåºåˆ—åŒ–å™¨å¯ä»¥æ˜ç¡®çŸ¥é“ä½¿ç”¨å“ªä¸ªæ„é€ å‡½æ•°

---

## ä¸ƒã€æµ‹è¯•è¦†ç›–

### 7.1 è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶

| æµ‹è¯• | æè¿° | è¦†ç›–å†…å®¹ | çŠ¶æ€ |
|------|------|---------|------|
| æµ‹è¯•1 | ç”ŸæˆD3é¡¹ç›®ï¼ˆæœ¬åœ°å•ç‰¹æ€§ï¼‰ | å®¢æˆ·ç«¯ç”Ÿæˆã€ä»£ç åˆ†æã€D3é©±åŠ¨ç”Ÿæˆ | âœ… |
| æµ‹è¯•2 | ç¼–è¯‘é¡¹ç›® | é¡¹ç›®ç¼–è¯‘ã€é”™è¯¯å¤„ç† | âœ… |
| æµ‹è¯•3 | è°ƒæ•´æ–¹æ³•åˆ†ç±» | æ–¹æ³•ç‰¹æ€§è°ƒæ•´ã€é‡æ–°ç”Ÿæˆ | âœ… |
| æµ‹è¯•4 | æ— æ•ˆæ–‡ä»¶å¤„ç† | é”™è¯¯å¤„ç†ã€å‹å¥½æç¤º | âœ… |
| æµ‹è¯•5 | ç¼–è¯‘å¤±è´¥å¤„ç† | ç¼–è¯‘é”™è¯¯è§£æã€é”™è¯¯ç»Ÿè®¡ | âœ… |
| æµ‹è¯•6 | å¤šç‰¹æ€§å®Œæ•´æµç¨‹ï¼ˆæœ¬åœ°ï¼‰ | å¤šç‰¹æ€§æ•´åˆã€å‘½åå†²çªå¤„ç† | âœ… |
| æµ‹è¯•7 | åœ¨çº¿æœåŠ¡å™¨å®Œæ•´æµç¨‹ | æœåŠ¡å™¨æ‰«æã€åœ¨çº¿ç”Ÿæˆã€å»é‡åŠŸèƒ½ | âœ… |

### 7.2 æµ‹è¯•ç»Ÿè®¡

- **æ€»æµ‹è¯•æ•°**ï¼š7ä¸ª
- **é€šè¿‡ç‡**ï¼š100%
- **æµ‹è¯•è¦†ç›–**ï¼š
  - âœ… å®¢æˆ·ç«¯ä»£ç ç”Ÿæˆ
  - âœ… ä»£ç åˆ†æå’Œåå°„
  - âœ… D3é©±åŠ¨ä»£ç ç”Ÿæˆ
  - âœ… é¡¹ç›®ç¼–è¯‘
  - âœ… æ–¹æ³•åˆ†ç±»è°ƒæ•´
  - âœ… é”™è¯¯å¤„ç†
  - âœ… åœ¨çº¿æœåŠ¡å™¨é›†æˆ
  - âœ… ä»£ç å»é‡
  - âœ… DLLè‡ªåŠ¨å¤åˆ¶

### 7.3 è¿è¡Œæµ‹è¯•

```bash
cd Sila2DriverGen/TestConsole
dotnet run -- --auto  # è¿è¡Œæ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•
dotnet run            # äº¤äº’å¼æµ‹è¯•èœå•
```

---

## å…«ã€ä½¿ç”¨æŒ‡å—

### 8.1 å¿«é€Ÿå¼€å§‹

#### æ–¹å¼1ï¼šä½¿ç”¨æœ¬åœ°.sila.xmlæ–‡ä»¶ï¼ˆæ¨èï¼‰

1. ç‚¹å‡»"ğŸ“ æ·»åŠ æœ¬åœ°ç‰¹æ€§"æŒ‰é’®
2. é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ª.sila.xmlæ–‡ä»¶
3. åœ¨ä¾§è¾¹æ å‹¾é€‰éœ€è¦çš„ç‰¹æ€§
4. ç‚¹å‡»"âœ¨ ç”ŸæˆD3é¡¹ç›®"æŒ‰é’®
5. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­è¾“å…¥è®¾å¤‡ä¿¡æ¯ï¼ˆå“ç‰Œã€å‹å·ã€ç±»å‹ã€å¼€å‘è€…ï¼‰
6. åœ¨æ–¹æ³•é¢„è§ˆçª—å£ä¸­å‹¾é€‰"è°ƒåº¦æ–¹æ³•"æˆ–"ç»´æŠ¤æ–¹æ³•"
7. ç‚¹å‡»"ç¡®å®š"ç”Ÿæˆé¡¹ç›®
8. ç‚¹å‡»"ğŸ”¨ ç¼–è¯‘D3é¡¹ç›®"æŒ‰é’®ç¼–è¯‘
9. ç¼–è¯‘æˆåŠŸåï¼Œç‚¹å‡»"ğŸ“¦ æ‰“å¼€DLLç›®å½•"æŸ¥çœ‹è¾“å‡º

#### æ–¹å¼2ï¼šä½¿ç”¨åœ¨çº¿æœåŠ¡å™¨

1. ç‚¹å‡»"ğŸ” æ‰«ææœåŠ¡å™¨"æŒ‰é’®
2. ç­‰å¾…æ‰«æå®Œæˆï¼ˆçº¦3ç§’ï¼‰
3. å±•å¼€æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œå‹¾é€‰éœ€è¦çš„ç‰¹æ€§ï¼ˆé™åŒä¸€æœåŠ¡å™¨ï¼‰
4. åç»­æ­¥éª¤åŒ"æ–¹å¼1"çš„ç¬¬4-9æ­¥

### 8.2 é«˜çº§åŠŸèƒ½

#### å¯¼å‡ºç‰¹æ€§æ–‡ä»¶

1. å‹¾é€‰éœ€è¦å¯¼å‡ºçš„ç‰¹æ€§
2. ç‚¹å‡»"ğŸ“¤ å¯¼å‡ºç‰¹æ€§"æŒ‰é’®
3. é€‰æ‹©å¯¼å‡ºç›®å½•
4. ç³»ç»Ÿä¼šå°†.sila.xmlæ–‡ä»¶å¤åˆ¶æˆ–ä¸‹è½½åˆ°ç›®æ ‡ç›®å½•

#### è°ƒæ•´æ–¹æ³•ç‰¹æ€§

1. åœ¨ç”Ÿæˆé¡¹ç›®åï¼Œç‚¹å‡»"ğŸ”§ è°ƒæ•´æ–¹æ³•ç‰¹æ€§"æŒ‰é’®
2. é‡æ–°é…ç½®æ–¹æ³•çš„"è°ƒåº¦"æˆ–"ç»´æŠ¤"æ ‡è®°
3. ç‚¹å‡»"ç¡®å®š"åï¼Œç³»ç»Ÿä¼šé‡æ–°ç”Ÿæˆ `D3Driver.cs` æ–‡ä»¶
4. é‡æ–°ç¼–è¯‘é¡¹ç›®ä»¥åº”ç”¨æ›´æ”¹

#### æ‰¹é‡æ“ä½œ

åœ¨æ–¹æ³•é¢„è§ˆçª—å£ä¸­ï¼š
- **å…¨éƒ¨è°ƒåº¦**ï¼šå°†æ‰€æœ‰æ–¹æ³•æ ‡è®°ä¸ºè°ƒåº¦æ–¹æ³•
- **å…¨éƒ¨ç»´æŠ¤**ï¼šå°†æ‰€æœ‰æ–¹æ³•æ ‡è®°ä¸ºç»´æŠ¤æ–¹æ³•
- **æ¸…é™¤ç‰¹æ€§**ï¼šæ¸…é™¤æ‰€æœ‰æ–¹æ³•çš„ç‰¹æ€§æ ‡è®°

### 8.3 æ³¨æ„äº‹é¡¹

1. **å•æœåŠ¡å™¨é™åˆ¶**ï¼šåªèƒ½é€‰æ‹©åŒä¸€æœåŠ¡å™¨çš„ç‰¹æ€§ï¼Œè·¨æœåŠ¡å™¨é€‰æ‹©ä¼šè‡ªåŠ¨å–æ¶ˆå¹¶æç¤ºé”™è¯¯

2. **æ–¹æ³•å‘½å**ï¼š
   - D3è°ƒç”¨çš„æ–¹æ³•ä¸èƒ½æœ‰é‡è½½ï¼ˆæ–¹æ³•åç›¸åŒä½†å‚æ•°ä¸åŒï¼‰
   - å¦‚æœ‰å‘½åå†²çªï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ  `FeatureName_` å‰ç¼€

3. **ç±»å‹æ”¯æŒ**ï¼š
   - ä¸æ”¯æŒçš„å¤æ‚ç±»å‹ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
   - è°ƒç”¨æ—¶éœ€è¦ä¼ é€’JSONæ ¼å¼çš„å­—ç¬¦ä¸²å‚æ•°

4. **ç¼–è¯‘è¦æ±‚**ï¼š
   - éœ€è¦.NET SDK 8.0æˆ–æ›´é«˜ç‰ˆæœ¬
   - ç¡®ä¿reflibç›®å½•åŒ…å«æ‰€æœ‰å¿…éœ€çš„DLL

### 8.4 ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

```
BR.ECS.DeviceDrivers.{DeviceType}.{Brand}_{Model}/
â”œâ”€â”€ BR.ECS.DeviceDrivers.{DeviceType}.{Brand}_{Model}.csproj
â”œâ”€â”€ BR.ECS.DeviceDrivers.{DeviceType}.{Brand}_{Model}.sln
â”œâ”€â”€ GeneratedClient/
â”‚   â”œâ”€â”€ *Client.cs              # Tecan Generatorç”Ÿæˆçš„å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ *Dtos.cs                # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ I*.cs                   # æ¥å£å®šä¹‰
â”‚   â””â”€â”€ *.dll                   # ä¾èµ–åº“
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ BR.PC.Device.Sila2Discovery.dll
â”‚   â”œâ”€â”€ BR.ECS.Executor.Device.*.dll
â”‚   â””â”€â”€ ...
â”œâ”€â”€ AllSila2Client.cs           # å¤šç‰¹æ€§æ•´åˆç±»
â”œâ”€â”€ D3Driver.cs                 # D3é©±åŠ¨ä¸»ç±»
â”œâ”€â”€ Sila2Base.cs                # åŸºç±»
â””â”€â”€ CommunicationPars.cs        # é€šä¿¡é…ç½®
```

### 8.5 å¸¸è§é—®é¢˜

**Q: ç¼–è¯‘å¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ°æŸä¸ªç±»å‹ï¼Ÿ**  
A: ç¡®ä¿reflibç›®å½•åŒ…å«æ‰€æœ‰å¿…éœ€çš„DLLï¼Œæˆ–æ£€æŸ¥ä¾èµ–åº“ç‰ˆæœ¬æ˜¯å¦åŒ¹é…ã€‚

**Q: æ–¹æ³•é¢„è§ˆçª—å£ä¸­æ²¡æœ‰æ˜¾ç¤ºæŸäº›æ–¹æ³•ï¼Ÿ**  
A: æ£€æŸ¥æ–¹æ³•æ˜¯å¦æ˜¯publicçš„ï¼Œä»¥åŠè¿”å›ç±»å‹æ˜¯å¦è¢«æ­£ç¡®è¯†åˆ«ã€‚

**Q: åœ¨çº¿æœåŠ¡å™¨æ‰«æä¸åˆ°ä»»ä½•è®¾å¤‡ï¼Ÿ**  
A: ç¡®ä¿SiLA2æœåŠ¡å™¨æ­£åœ¨è¿è¡Œã€åœ¨åŒä¸€ç½‘ç»œå†…ï¼Œä¸”mDNSæœåŠ¡å·²å¯ç”¨ã€‚

**Q: ç”Ÿæˆçš„ä»£ç æœ‰é‡å¤çš„ç±»å‹å®šä¹‰ï¼Ÿ**  
A: ç³»ç»Ÿä¼šè‡ªåŠ¨å»é‡ï¼Œä½†å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨æ³¨é‡Šæ‰é‡å¤çš„å®šä¹‰ã€‚

**Q: å¦‚ä½•åˆ¤æ–­å“ªäº›æ–¹æ³•åº”è¯¥æ ‡è®°ä¸º"è°ƒåº¦æ–¹æ³•"æˆ–"ç»´æŠ¤æ–¹æ³•"ï¼Ÿ**  
A: 
- **è°ƒåº¦æ–¹æ³•**ï¼šD3è°ƒåº¦ç³»ç»Ÿä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œé€šå¸¸æ˜¯è®¾å¤‡çš„æ ¸å¿ƒæ“ä½œ
- **ç»´æŠ¤æ–¹æ³•**ï¼šè®¾å¤‡ç»´æŠ¤ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚æ ¡å‡†ã€å¤ä½ã€åˆå§‹åŒ–ç­‰
- ç³»ç»Ÿä¼šæ ¹æ®æ–¹æ³•åè‡ªåŠ¨åˆ¤æ–­ï¼ˆåŒ…å« maintenanceã€calibrateã€resetã€initã€config çš„æ–¹æ³•é»˜è®¤ä¸ºç»´æŠ¤æ–¹æ³•ï¼‰

---

## é™„å½•ï¼šä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### A. æ ¸å¿ƒæœåŠ¡

| æ–‡ä»¶ | åŠŸèƒ½ | å…³é”®ç±»/æ–¹æ³• |
|------|------|-----------|
| `Services/ClientCodeGenerator.cs` | å®¢æˆ·ç«¯ä»£ç ç”Ÿæˆ | `GenerateClientCode`, `CopyRequiredDllsToClientDirectory` |
| `Services/ClientCodeAnalyzer.cs` | ä»£ç åˆ†æ | `Analyze`, `CompileToAssembly`, `IsSupportedType` |
| `Services/D3DriverGeneratorService.cs` | D3é©±åŠ¨ç”Ÿæˆ | `Generate`, `CompileProjectAsync`, `CopyDependencyLibraries` |
| `Services/GeneratedCodeDeduplicator.cs` | ä»£ç å»é‡ | `DeduplicateGeneratedCode`, `CommentOutDuplicateTypes` |
| `Services/CodeDom/AllSila2ClientGenerator.cs` | AllSila2Clientç”Ÿæˆ | `GenerateCode` |
| `Services/CodeDom/D3DriverGenerator.cs` | D3Driverç”Ÿæˆ | `GenerateCode`, `AddMethodBody`, `GetFriendlyTypeName` |

### B. UIå’ŒViewModel

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `Views/D3DriverView.xaml` | ä¸»ç•Œé¢ |
| `Views/MethodPreviewWindow.xaml` | æ–¹æ³•é¢„è§ˆçª—å£ |
| `ViewModels/D3DriverViewModel.cs` | ä¸»ViewModel |
| `ViewModels/MethodPreviewViewModel.cs` | æ–¹æ³•é¢„è§ˆViewModel |

### C. æ•°æ®æ¨¡å‹

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `Models/MethodGenerationInfo.cs` | æ–¹æ³•ä¿¡æ¯æ¨¡å‹ |
| `Models/ParameterGenerationInfo.cs` | å‚æ•°ä¿¡æ¯æ¨¡å‹ |
| `Models/ClientAnalysisResult.cs` | åˆ†æç»“æœæ¨¡å‹ |
| `Models/D3DriverGenerationConfig.cs` | ç”Ÿæˆé…ç½®æ¨¡å‹ |

### D. æµ‹è¯•

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `TestConsole/AutomatedTest.cs` | è‡ªåŠ¨åŒ–æµ‹è¯• |
| `TestConsole/TestRunner.cs` | äº¤äº’å¼æµ‹è¯• |
| `TestConsole/README.md` | æµ‹è¯•è¯´æ˜ |

### E. Tecan Generator

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `Generator/Generators/DtoGenerator.cs` | DTOç”Ÿæˆå™¨ï¼ˆæ·»åŠ JsonConstructorç‰¹æ€§ï¼‰ |

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0  
**ç”Ÿæˆæ—¶é—´**ï¼š2024-10-24 16:30  
**é€‚ç”¨ç‰ˆæœ¬**ï¼šSiLA2 D3é©±åŠ¨ç”Ÿæˆå·¥å…· v1.0
