# 测试运行指南

## 快速开始

### 运行自动化测试（推荐）

```bash
cd Sila2DriverGen/TestConsole
dotnet build
dotnet run -- --auto
```

自动化测试会按顺序运行所有测试用例，并报告结果。

### 运行交互式测试

```bash
cd Sila2DriverGen/TestConsole
dotnet run
```

然后根据菜单提示选择要运行的测试。

## 测试用例说明

### 自动化测试（推荐）

运行命令：`dotnet run -- --auto`

自动化测试会依次执行以下测试：
1. ✅ 测试1：生成D3项目
2. ✅ 测试2：编译项目
3. ✅ 测试3：调整方法分类
4. ✅ 测试4：无效文件处理
5. ✅ 测试5：编译失败处理
6. ✅ 测试6：多特性完整流程

所有测试都通过后会显示：
```
═══ 自动化测试结果 ═══
✓ 所有测试通过！
```

### 交互式测试

运行命令：`dotnet run`

菜单选项：
1. 测试1：从本地XML生成D3项目
2. 测试2：编译已生成的D3项目
3. 测试3：完整流程（生成+编译）
4. 测试4：调整方法分类并重新生成
5. 测试5：错误处理测试（无效文件）
6. 测试6：错误处理测试（编译失败）
7. 测试7：完整流程测试（多特性）
8. 测试8：查看测试说明
9. 退出

## 测试覆盖范围

### 基本功能测试
- ✅ 从本地XML生成D3项目
- ✅ 客户端代码生成
- ✅ 代码分析功能
- ✅ D3驱动代码生成
- ✅ 项目编译

### 高级功能测试
- ✅ 方法分类调整
- ✅ 重新生成D3Driver.cs
- ✅ 多特性集成

### 错误处理测试
- ✅ 无效文件错误处理
- ✅ 编译失败错误处理
- ✅ 异常捕获和报告

## 验证点

所有测试通过后，应验证以下内容：

### 代码生成验证
- [x] 客户端代码文件已生成（Interface、Client、DTOs）
- [x] D3驱动文件已生成（AllSila2Client.cs、D3Driver.cs等）
- [x] 项目文件已生成（.csproj、.sln）
- [x] 依赖库已复制（lib目录）

### 编译验证
- [x] 项目编译成功，无错误
- [x] DLL文件已生成在 bin/Release 目录
- [x] 警告数量合理（0个警告）

### 功能验证
- [x] ClientCodeAnalyzer 能够正确分析客户端代码
- [x] D3DriverGeneratorService 能够生成正确的D3驱动代码
- [x] 方法分类调整功能正常
- [x] 多特性能够正确集成

### 错误处理验证
- [x] 无效文件错误能够正确捕获
- [x] 编译失败错误能够正确报告
- [x] 程序不会因错误崩溃

## 测试结果

最新测试结果：
- 测试日期：2024-10-24
- 测试状态：✅ 全部通过
- 测试数量：6个测试用例
- 成功数量：6个
- 失败数量：0个

### 详细结果
| 测试编号 | 测试名称 | 结果 | 备注 |
|---------|---------|------|------|
| 测试1 | 生成D3项目 | ✅ 通过 | 成功生成项目 |
| 测试2 | 编译项目 | ✅ 通过 | 编译成功，无错误 |
| 测试3 | 调整方法分类 | ✅ 通过 | 方法分类功能正常 |
| 测试4 | 无效文件处理 | ✅ 通过 | 错误处理正确 |
| 测试5 | 编译失败处理 | ✅ 通过 | 错误处理正确 |
| 测试6 | 多特性完整流程 | ✅ 通过 | 多特性集成成功 |

## 常见问题

### Q1: 找不到XML文件
**解决方案**：
- 确保 `TemperatureController-v1_0.sila.xml` 文件存在
- 检查搜索路径：TestConsole目录、上级目录等
- 或手动将XML文件复制到 TestConsole 项目根目录

### Q2: 编译失败
**解决方案**：
- 确保已安装 .NET 8.0 SDK
- 确保网络连接正常（用于NuGet包还原）
- 运行 `dotnet restore` 手动还原包
- 检查错误日志查看具体错误信息

### Q3: 测试运行失败
**解决方案**：
- 查看详细的错误信息
- 确保所有前置条件满足
- 尝试重新编译测试项目：`dotnet build`
- 清理并重新编译：`dotnet clean && dotnet build`

### Q4: ClientCodeAnalyzer 编译错误
**解决方案**：
- 已修复：添加了 System.Collections 程序集引用
- 已修复：添加了必要的 Tecan.Sila2 引用
- 如果仍有问题，检查 Generator.dll 所在目录是否包含所有必需的DLL

## 技术细节

### 依赖的程序集
ClientCodeAnalyzer 需要以下程序集引用：
- System.Runtime
- System.Collections（已修复）
- System.ObjectModel
- System.ComponentModel.Primitives
- System.ComponentModel.Composition
- protobuf-net.dll
- protobuf-net.Core.dll
- Tecan.Sila2.dll
- Tecan.Sila2.Contracts.dll
- Tecan.Sila2.Annotations.dll

### 测试架构
```
TestConsole (控制台应用)
    ↓
D3DriverOrchestrationService (无UI依赖)
    ↓
├── ClientCodeGenerator (客户端代码生成)
├── ClientCodeAnalyzer (代码分析)
└── D3DriverGeneratorService (D3驱动生成)
```

## 相关文档
- [README.md](./README.md) - 详细的测试说明
- [D3驱动生成功能使用指南](../SilaGeneratorWpf/D3_DRIVER_GENERATION_GUIDE.md)
- [实施总结](../IMPLEMENTATION_SUMMARY.md)

---

**版本**: 1.1.0  
**更新日期**: 2024-10-24  
**维护者**: Bioyond Team
