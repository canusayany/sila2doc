<UserControl
    x:Class="SilaGeneratorWpf.Views.D3DriverView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:SilaGeneratorWpf.Models"
    xmlns:converters="clr-namespace:SilaGeneratorWpf.Converters"
    xmlns:behaviors="clr-namespace:SilaGeneratorWpf.Behaviors"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    d:DesignHeight="700"
    d:DesignWidth="1200"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <!--  å·¦ä¾§æ ï¼ˆå¯æŠ˜å ï¼‰  -->
            <ColumnDefinition Width="{Binding SidebarWidthValue}" MinWidth="0" MaxWidth="450" />
            <!--  GridSplitter  -->
            <ColumnDefinition Width="5" />
            <!--  ä¸»åŒºåŸŸ  -->
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  å·¦ä¾§æ ï¼šç‰¹æ€§é€‰æ‹©  -->
        <Border
            Grid.Column="0"
            Background="#F8F9FA"
            BorderBrush="#DEE2E6"
            BorderThickness="0,0,1,0"
            Visibility="{Binding IsSidebarVisible, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <!--  æ ‡é¢˜æ   -->
                    <RowDefinition Height="Auto" />
                    <!--  å·¥å…·æ   -->
                    <RowDefinition Height="250" />
                    <!--  åœ¨çº¿æœåŠ¡å™¨æ ‘ï¼ˆå›ºå®šé«˜åº¦ï¼‰  -->
                    <RowDefinition Height="*" />
                    <!--  æœ¬åœ°ç‰¹æ€§æ ‘ï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼‰  -->
                </Grid.RowDefinitions>

                <!--  æ ‡é¢˜æ ï¼ˆVS2022é£Žæ ¼ï¼Œå¸¦æŠ˜å æŒ‰é’®ï¼‰  -->
                <Border 
                    Grid.Row="0" 
                    Background="#E8EAED" 
                    BorderBrush="#DEE2E6" 
                    BorderThickness="0,0,0,1"
                    Padding="10,5">
                    <Grid>
                        <TextBlock
                            Text="ç‰¹æ€§é€‰æ‹©"
                            FontSize="14"
                            FontWeight="SemiBold"
                            VerticalAlignment="Center"
                            Foreground="#2C3E50" />
                        
                        <!--  å›¾é’‰æŒ‰é’®ï¼ˆå³ä¾§ï¼‰  -->
                        <Button
                            HorizontalAlignment="Right"
                            Width="20"
                            Height="20"
                            Background="Transparent"
                            BorderThickness="0"
                            Command="{Binding ToggleSidebarCommand}"
                            ToolTip="éšè—ä¾§è¾¹æ  (åŒå‡»åˆ†éš”çº¿ä¹Ÿå¯åˆ‡æ¢)"
                            Cursor="Hand">
                            <TextBlock 
                                Text="ðŸ“Œ" 
                                FontSize="12" 
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center">
                                <TextBlock.RenderTransform>
                                    <RotateTransform Angle="-45" CenterX="6" CenterY="6"/>
                                </TextBlock.RenderTransform>
                            </TextBlock>
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="Transparent" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#D0D3D6" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Border>

                <!--  å·¥å…·æ   -->
                <StackPanel
                    Grid.Row="1"
                    Margin="10"
                    Orientation="Vertical">

                    <!--  å®žæ—¶ç›‘æŽ§çŠ¶æ€æ˜¾ç¤º  -->
                    <Border 
                        Background="#E8F5E9"
                        BorderBrush="#4CAF50"
                        BorderThickness="1"
                        CornerRadius="3"
                        Padding="8,5"
                        Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock 
                                Text="ðŸŸ¢" 
                                FontSize="12" 
                                VerticalAlignment="Center"
                                Margin="0,0,5,0"/>
                            <TextBlock 
                                Text="å®žæ—¶ç›‘æŽ§å·²å¯åŠ¨" 
                                FontSize="11"
                                FontWeight="Medium"
                                Foreground="#2E7D32"
                                VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <Button
                            Margin="0,0,5,0"
                            Padding="10,8"
                            Background="#8764B8"
                            BorderThickness="0"
                            Command="{Binding AddLocalFeaturesCommand}"
                            Content="ðŸ“ æ·»åŠ "
                            Foreground="White"
                            FontWeight="Medium"
                            ToolTip="å¯¼å…¥æœ¬åœ°.sila.xmlç‰¹æ€§æ–‡ä»¶">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="#8764B8"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#744DA9"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <Button
                            Padding="10,8"
                            Background="#107C10"
                            BorderThickness="0"
                            Command="{Binding ExportFeaturesCommand}"
                            Content="ðŸ“¤ å¯¼å‡º"
                            Foreground="White"
                            FontWeight="Medium"
                            ToolTip="å¯¼å‡ºé€‰ä¸­çš„ç‰¹æ€§æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="#107C10"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#0E6A0E"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </StackPanel>

                <!--  åœ¨çº¿æœåŠ¡å™¨æ ‘ï¼ˆå›ºå®šé«˜åº¦250pxï¼‰  -->
                <GroupBox
                    Grid.Row="2"
                    Header="åœ¨çº¿æœåŠ¡å™¨"
                    Margin="10,0,10,10">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Height="210">
                        <TreeView ItemsSource="{Binding OnlineServers}">
                        <TreeView.Resources>
                            <!--  æœåŠ¡å™¨èŠ‚ç‚¹æ¨¡æ¿ï¼ˆä¸‰æ€CheckBoxï¼‰  -->
                            <HierarchicalDataTemplate DataType="{x:Type local:ServerInfoViewModel}" ItemsSource="{Binding Features}">
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox
                                        Margin="0,0,5,0"
                                        IsThreeState="True"
                                        IsChecked="{Binding IsPartiallySelected}">
                                        <i:Interaction.Behaviors>
                                            <behaviors:ThreeStateTreeViewBehavior />
                                        </i:Interaction.Behaviors>
                                    </CheckBox>
                                    <TextBlock Margin="0,0,5,0" Text="ðŸ–¥ï¸" />
                                    <TextBlock Text="{Binding DisplayText}" />
                                </StackPanel>
                            </HierarchicalDataTemplate>
                            <!--  ç‰¹æ€§èŠ‚ç‚¹æ¨¡æ¿  -->
                            <DataTemplate DataType="{x:Type local:FeatureInfoViewModel}">
                                <StackPanel Orientation="Horizontal">
                                    <CheckBox Margin="0,0,5,0" IsChecked="{Binding IsSelected}" />
                                    <TextBlock Margin="0,0,5,0" Text="ðŸ“¦" />
                                    <TextBlock Text="{Binding DisplayText}" />
                                </StackPanel>
                            </DataTemplate>
                        </TreeView.Resources>
                        </TreeView>
                    </ScrollViewer>
                </GroupBox>

                <!--  æœ¬åœ°ç‰¹æ€§æ ‘ï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼‰  -->
                <GroupBox
                    Grid.Row="3"
                    Header="æœ¬åœ°ç‰¹æ€§"
                    Margin="10,0,10,10"
                    Visibility="{Binding LocalNodes.Count, Converter={StaticResource CountToVisibilityConverter}}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <TreeView ItemsSource="{Binding LocalNodes}" x:Name="LocalFeaturesTreeView" Tag="{Binding}">
                        <TreeView.Resources>
                            <!--  æœ¬åœ°èŠ‚ç‚¹æ¨¡æ¿  -->
                            <HierarchicalDataTemplate DataType="{x:Type local:LocalFeatureNodeViewModel}" ItemsSource="{Binding Files}">
                                <StackPanel Orientation="Horizontal" Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=TreeView}}">
                                    <CheckBox
                                        Margin="0,0,5,0"
                                        IsThreeState="True"
                                        IsChecked="{Binding IsPartiallySelected}"
                                        ToolTip="ç‚¹å‡»åˆ‡æ¢ï¼šæœªé€‰â†’å…¨é€‰â†’æœªé€‰ï¼ŒåŠé€‰â†’æœªé€‰">
                                        <i:Interaction.Behaviors>
                                            <behaviors:ThreeStateTreeViewBehavior />
                                        </i:Interaction.Behaviors>
                                    </CheckBox>
                                    <TextBlock Margin="0,0,5,0" Text="ðŸ“‚" />
                                    <TextBlock Text="{Binding DisplayText}" ToolTip="{Binding NodePath}" />
                                    <StackPanel.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="åˆ é™¤èŠ‚ç‚¹" 
                                                      Command="{Binding PlacementTarget.Tag.DeleteLocalNodeCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" 
                                                      CommandParameter="{Binding}" />
                                        </ContextMenu>
                                    </StackPanel.ContextMenu>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                            <!--  æœ¬åœ°ç‰¹æ€§æ–‡ä»¶æ¨¡æ¿  -->
                            <HierarchicalDataTemplate DataType="{x:Type local:LocalFeatureFileViewModel}">
                                <StackPanel Orientation="Horizontal" Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=TreeView}}">
                                    <CheckBox Margin="0,0,5,0" IsChecked="{Binding IsSelected}" />
                                    <TextBlock Margin="0,0,5,0" Text="ðŸ“„" />
                                    <TextBlock Text="{Binding FileName}" />
                                    <StackPanel.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="åˆ é™¤æ–‡ä»¶" 
                                                      Command="{Binding PlacementTarget.Tag.DeleteLocalFileCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}" 
                                                      CommandParameter="{Binding}" />
                                        </ContextMenu>
                                    </StackPanel.ContextMenu>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.Resources>
                        </TreeView>
                    </ScrollViewer>
                </GroupBox>
            </Grid>
        </Border>

        <!--  GridSplitterï¼ˆå¯æ‹–åŠ¨è°ƒæ•´å®½åº¦ï¼ŒåŒå‡»åˆ‡æ¢ä¾§è¾¹æ ï¼‰  -->
        <GridSplitter
            Grid.Column="1"
            Width="5"
            HorizontalAlignment="Stretch"
            Background="#DEE2E6"
            MouseDoubleClick="GridSplitter_MouseDoubleClick"
            Cursor="SizeWE"
            ToolTip="æ‹–åŠ¨è°ƒæ•´å®½åº¦ï¼ŒåŒå‡»éšè—ä¾§è¾¹æ "
            Visibility="{Binding IsSidebarVisible, Converter={StaticResource BoolToVisibilityConverter}}" />
        
        <!--  ä¾§è¾¹æ éšè—æ—¶çš„æ˜¾ç¤ºæŒ‰é’®ï¼ˆç«–å‘æ–‡å­—ï¼‰  -->
        <Button
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Width="30"
            Height="120"
            
            HorizontalAlignment="Left"
            VerticalAlignment="Center"
            Background="#F8F9FA"
            BorderThickness="1"
            BorderBrush="#DEE2E6"
            Command="{Binding ToggleSidebarCommand}"
            Cursor="Hand"
            ToolTip="æ˜¾ç¤ºä¾§è¾¹æ "
            Visibility="{Binding IsSidebarVisible, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
                <TextBlock 
                    Text="ðŸ“Œ" 
                    FontSize="14"
                    Margin="0,5,0,5"
                    HorizontalAlignment="Center">
                    <TextBlock.RenderTransform>
                        <RotateTransform Angle="45" CenterX="7" CenterY="7"/>
                    </TextBlock.RenderTransform>
                </TextBlock>
                <TextBlock 
                    Text="ç‰¹" 
                    FontSize="12" 
                    FontWeight="SemiBold"
                    Foreground="#2C3E50"
                    HorizontalAlignment="Center"
                    Margin="0,2"/>
                <TextBlock 
                    Text="æ€§" 
                    FontSize="12" 
                    FontWeight="SemiBold"
                    Foreground="#2C3E50"
                    HorizontalAlignment="Center"
                    Margin="0,2"/>
                <TextBlock 
                    Text="é€‰" 
                    FontSize="12" 
                    FontWeight="SemiBold"
                    Foreground="#2C3E50"
                    HorizontalAlignment="Center"
                    Margin="0,2"/>
                <TextBlock 
                    Text="æ‹©" 
                    FontSize="12" 
                    FontWeight="SemiBold"
                    Foreground="#2C3E50"
                    HorizontalAlignment="Center"
                    Margin="0,2"/>
            </StackPanel>
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="Background" Value="#F8F9FA" />
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#E8EAED" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>

        <!--  ä¸»åŒºåŸŸï¼ˆç§»é™¤æ–¹æ³•é¢„è§ˆå’Œè®¾å¤‡ä¿¡æ¯è¾“å…¥ï¼‰  -->
        <Grid Grid.Column="2" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <!--  è¿‡ç¨‹æ—¥å¿—  -->
                <RowDefinition Height="*" />
                <!--  é¡¹ç›®ä¿¡æ¯  -->
                <RowDefinition Height="Auto" />
                <!--  æ“ä½œæŒ‰é’®  -->
            </Grid.RowDefinitions>

            <!--  è¿‡ç¨‹ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ  -->
            <Expander
                Grid.Row="0"
                Header="ç”Ÿæˆè¿‡ç¨‹ä¿¡æ¯"
                IsExpanded="True"
                Margin="0,0,0,10">
                <TextBox
                    Height="200"
                    FontFamily="Consolas"
                    IsReadOnly="True"
                    Text="{Binding ProcessLog, Mode=OneWay}"
                    TextWrapping="Wrap"
                    Foreground="{Binding ProcessLogColor}"
                    VerticalScrollBarVisibility="Auto" />
            </Expander>

            <!--  é¡¹ç›®ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ  -->
            <GroupBox
                Grid.Row="1"
                Header="é¡¹ç›®ä¿¡æ¯"
                Margin="0,0,0,10">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <TextBlock
                        Text="{Binding ProjectInfoText}"
                        TextWrapping="Wrap"
                        Padding="10"
                        FontFamily="Consolas" />
                </ScrollViewer>
            </GroupBox>

            <!--  æ“ä½œæŒ‰é’®ï¼ˆ5ä¸ªï¼‰  -->
            <WrapPanel
                Grid.Row="2"
                HorizontalAlignment="Right"
                Orientation="Horizontal">
                <Button
                    Margin="5"
                    Padding="12,8"
                    Background="#107C10"
                    BorderThickness="0"
                    Command="{Binding OpenProjectDirectoryCommand}"
                    Content="ðŸ—‚ï¸ é¡¹ç›®ç›®å½•"
                    Foreground="White"
                    FontWeight="Medium"
                    ToolTip="æ‰“å¼€ç”Ÿæˆçš„é¡¹ç›®ç›®å½•">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#107C10"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#0E6A0E"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    Margin="5"
                    Padding="12,8"
                    Background="#8764B8"
                    BorderThickness="0"
                    Command="{Binding OpenDllDirectoryCommand}"
                    Content="ðŸ“¦ DLLç›®å½•"
                    Foreground="White"
                    FontWeight="Medium"
                    ToolTip="æ‰“å¼€ç¼–è¯‘è¾“å‡ºçš„DLLç›®å½•">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#8764B8"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#744DA9"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    Margin="5"
                    Padding="12,8"
                    Background="#0078D4"
                    BorderThickness="0"
                    Command="{Binding GenerateD3ProjectCommand}"
                    Content="âœ¨ ç”Ÿæˆé¡¹ç›®"
                    Foreground="White"
                    FontWeight="Bold"
                    ToolTip="ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç å’ŒD3é©±åŠ¨ä»£ç ï¼ˆä¸ç¼–è¯‘ï¼‰">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#0078D4"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#106EBE"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    Margin="5"
                    Padding="12,8"
                    Background="#0078D4"
                    BorderThickness="0"
                    Command="{Binding CompileD3ProjectCommand}"
                    Content="ðŸ”¨ ç¼–è¯‘é¡¹ç›®"
                    Foreground="White"
                    FontWeight="Bold"
                    IsEnabled="{Binding CanCompile}"
                    ToolTip="ç¼–è¯‘å·²ç”Ÿæˆçš„é¡¹ç›®ï¼ˆéœ€è¦å…ˆç”Ÿæˆï¼‰">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#0078D4"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#106EBE"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="False">
                                    <Setter Property="Background" Value="#CCCCCC"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    Margin="5"
                    Padding="12,8"
                    Background="#CA5010"
                    BorderThickness="0"
                    Command="{Binding AdjustMethodAttributesCommand}"
                    Content="ðŸ”§ è°ƒæ•´ç‰¹æ€§"
                    Foreground="White"
                    FontWeight="Medium"
                    Visibility="{Binding CanAdjustMethods, Converter={StaticResource BoolToVisibilityConverter}}"
                    ToolTip="æ‰“å¼€æ–¹æ³•é¢„è§ˆä¸Žç‰¹æ€§è°ƒæ•´çª—å£">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#CA5010"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#A74109"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    Margin="5"
                    Padding="12,8"
                    Background="#00796B"
                    BorderThickness="0"
                    Command="{Binding PackageDriverCommand}"
                    Content="ðŸ“¦ æ‰“åŒ…é©±åŠ¨"
                    Foreground="White"
                    FontWeight="Bold"
                    Visibility="{Binding CanPackage, Converter={StaticResource BoolToVisibilityConverter}}"
                    ToolTip="ç”Ÿæˆæè¿°æ–‡ä»¶å¹¶æ‰“åŒ…é©±åŠ¨">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#00796B"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#00695C"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button
                    Margin="5"
                    Padding="12,8"
                    Background="#5C6BC0"
                    BorderThickness="0"
                    Command="{Binding TestPackageDriverCommand}"
                    Content="ðŸ§ª æµ‹è¯•æ‰“åŒ…"
                    Foreground="White"
                    FontWeight="Medium"
                    Visibility="Collapsed"
                    ToolTip="ä½¿ç”¨å›ºå®šè·¯å¾„æµ‹è¯•ç”Ÿæˆæè¿°æ–‡ä»¶ä¸Žæ‰“åŒ…æµç¨‹">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="#5C6BC0"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#3F51B5"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </WrapPanel>
        </Grid>
    </Grid>
</UserControl>
